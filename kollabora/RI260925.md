-----------------------------------------------------------------------------------
# Rapport d'intervention - 26/09/25

- Installation du serveur sous debian 13, connexion par SSH via .pem
- Update && upgrade des dépots
- Installation de curl, btop et gpg via APT
- Initialisation des dépots contrib et non-free
- Installation de docker depuis get.docker.com
- Installation de ufw 
- Création du répertoire /home/admin/compose/excalidraw
- Copie du yaml [excalidraw](https://github.com/adenyrr/adminsys/blob/main/kollabora/compose/excalidraw/compose.yaml)
- ```docker compose up -d```   
    
# Démarrage du service

Pas de connexion possible depuis mon pc, ping impossible.

Causes probables : 
    
--> Pas d'ipv4 assignée à la machine AWS - ```curl http://checkip.amazonaws.com``` donne bien une IPv4 publique

--> Le conteneur est down - ```docker ps``` indique 'healty' et les logs du conteneur sont ok

--> Docker n'a pas publié le service sur le bon réseau - ```curl localhost:8085``` donne bien excalidraw.
    
    
--> L'IPv4 ne ping pas - *pourrait* etre du au blocage ICMP d'AWS.
    
    
Opérations de troubleshooting :


- Installation de lynx via APT (navigateur CLI) pour vérifier en local.

  --> ```lynx http://localhost:8085``` OK
  
  --> ```lynx http://IP_PUBLIC:8085``` N-OK
    
  --> Docker n'est pas accessible depuis l'IP publique - *Possiblement un réglage à faire dans la console AWS* : test du port 443

# DNS et reverse-proxy

- Enregistrement des DNS type A
- Création d'un répertoire /home/admin/compose/proxy
- Copie du yaml [proxy](https://github.com/adenyrr/adminsys/blob/main/kollabora/compose/proxy/compose.yaml)
- Configuration des variables d'environnements du ovh.ini dans le répertoire proxy
- ```docker compose up -d``` - Les certificats wildcard ont bien été installés
- Configuration d'un proxy-conf dans le répertoire /home/admin/compose/proxy/config/nginx/proxy-confs
- Enregitrement du [draw.kollabora.subdomain.conf](https://github.com/adenyrr/adminsys/blob/main/kollabora/compose/proxy/draw.subdomain.conf)

-----------------------------------------------------------------------------------
